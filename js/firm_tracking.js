(function(w){
  var config = {"metricsLabels":{"contentBoards":"tr_smart_page","audiences":"tr_audience","personalizations":"tr_personalization","campaigns":"tr_campaign"},"hitTypes":{"contentBoards":"event","audiences":"event","personalizations":"event","campaigns":"event"},"shouldTrackOrgAssets":true,"firmTrackProvider":"ga4","triblioVisitorId":"Mfqois9L58XtaTLl3JDvMSCd"};
  var triblioVisitorId = config.triblioVisitorId;
  var firmographicRecord =  {"name":"o2dc.com","sicCode":"N/A","isIsp":false,"employees":"N/A","revenue":"N/A","country":"N/A","domain":"o2dc.com","naicCode":"N/A","employeesCode":"N/A","revenueCode":"N/A","region":"N/A","city":"N/A","subIndustry":"N/A","industry":"N/A"};
  var shouldTrackOrgAssets = config.shouldTrackOrgAssets;
  var eIdsToNames = {"personalizations":{"GnpQ":"Event - Gartner DWS"},"campaigns":{"0OA5":"Event - Gartner DWS"},"contentHubs":{},"audiences":{"QKE9":"2. All Site Visitors - LP only","Z6q0":"1.A. - TAL - A,B","oQGP":"Campaign Intent - Help Desk (MM)","43ov":"1.A. - TAL A x Printent x Site Visitors","B6jO":"z. Prospect Accounts","a6XK":"z. Salesforce Accounts - Priority B","jkEa":"Engaged Prospects x Printent","6WgP":"Send Bobbi Names - First Stage","b69k":"Sr. IT - TAL A,B - First Stage","1E89":"Sr. IT - TAL A,B - Second Stage","5gd4":"2. All TAL","Y0AP":"L1 - v2 Cornerstone - TAL A,B - First Stage","nzpm":"2 Event Promotion - Gartner - First Stage","jk09":"Website Visitors - Print Drivers Campaign","5QZK":"1. TAL A, B - Financial (emails) - Second Stage","Wo33":"1. TAL A,B - Insurance (emails) - First Stage","m5m7":"1. TAL A,B - Insurance (emails) - Second Stage","o5Xb":"1. TAL A,B - Insurance (emails) - Third Stage","XwBj":"TAL A,B - Professional (email) - First Stage","dWgb":"TAL A,B - Professional (email) - Second Stage","6qv9":"1. TAL A, B - Financial (emails) - First Stage","x5zD":"1. TAL A, B - Financial (emails) - Third Stage","DvY8":"TAL A,B - Professional (email) - Third Stage","kBwW":"Website Visitors x TAL - Print Drivers","BK8B":"1.A - TAL A,B - Organic Visits","X668":"B. CS Contacts","4z0j":"CS Contacts - Content Promotion - First Stage","Pw7w":"CS Contacts - Content Promotion - Second Stage","OMqg":"L1 - v3 Cornerstone - TAL A,B - First Stage","10n0":"Event Overlay - Gartner","gJ3o":"Event - Gartner DWS","EKKB":"SalesLoft - First Stage","Yenm":"TAL AB - Intent: multi - Second Stage","aZR3":"TAL AB x Printer Security Copy","OBmk":"TAL AB x Printer Security Copy","Goo5":"Q2 2023 - Gartner Event","knDL":"US | 1k+ | Intent: Print Costs - First Stage","Bojw":"US | 1k+ | Intent: Print Costs - Second Stage","kjDW":"@DataSync","pbJn":"TAL AB - Intent: multi - First Stage","eW9P":"Push to LinkedIn - CS Prospects - First Stage","p5G9":"TAL A,B - Finance - Content Promotion - Second Stage","6zw5":"Retargeting - Products, solutions","wzYe":"C. Site Visitors - Excl. EDU","vX4B":"1.A - TAL A,B - Finance Intent","8LoX":"2. TAL B x Printent x Site Visitors","JwGq":"1.A. - TAL A,B - IT Intent","o4Gg":"TAL A,B - Sr. IT - Content Promotion - First Stage","o5pP":"TAL A,B - Finance - Content Promotion - First Stage","Pn5o":"US | 1k+ | Intent: multi - First Stage","6obE":"TAL AB - Intent: multi - Third Stage","zLmm":"US | 1k+ | Intent: multi - Second Stage","x5Yg":"Account Owner - ML","kO41":"Account Owner - RC","PD1v":"1.A - TAL A,B - Paid Visitors","8o7v":"Retargeting - Security","5bw2":"Retargeting - Resources","o4v9":"C. Print Assessment Viewers","kOJR":"2/15 training  - First Stage","JwKe":"Google Audience Segments - TAL A - First Stage","5Qgn":"Google Audience Segments - TAL B - First Stage","1BpW":"Recent Paid Leads","gJGG":"TAL A,B - Content Retargeting - First Stage","oPG3":"US | 1k+ | Intent - Printer Security - First Stage","vXd5":"1.A TAL B x Intent ","MowO":"US | 1k+ | Intent - Printer Security - Second Stage","x1zB":"US - 1k+ - Intent: Printer Security","0kAM":"TAL A,B - Awareness, Content, CTA - First Stage","2PxZ":"TAL A,B - Awareness, Content, CTA - Third Stage","WoPP":"TAL A,B - Finance - Content Promotion - Third Stage","g5GD":"TAL A,B - Awareness, Content, CTA - Second Stage","9Ejg":"TAL A,B - EUC - Help Desk (emails) - First Stage","o5D9":"TAL A,B - Sr. IT - Content Promotion - Second Stage","dWQx":"Site Visitors (all)","eZ2b":"US - 1k+ - Intent: Costs","9o3Z":"US - 1k+ - Intent: multi","EdG4":"TAL AB x Printer Security","RkdO":"TAL AB x Printer Security - First Stage","9EWm":"TAL A,B x Print Intent - Evaluation > CTA - First Stage","10zW":"TAL AB x Printer Security - Second Stage","1Bo5":"TAL A,B x Print Intent - Evaluation > CTA - Second Stage","qnkL":"1.B. - TAL A,B x Print Intent","Qwp4":"Event Promotion - Gartner - First Stage","YwAg":"SINGLE_ASSET_Overlay CTA - Print Assessment","Gw8Q":"SINGLE_ASSET_Overlay CTA 2 ","9EQb":"TAL A, B x Finance","EJlw":"TAL A, B x Insurance","RwOo":"TAL A,B x Professional","xQwb":"z. Salesforce Accounts - Priority A","YePg":"TAL AB x Print Costs - First Stage","00Ja":"Print Assessment Overlay CTA v2","wRZe":"TAL AB x Print Costs - Second Stage","RkMw":"TAL AB x Printent","Mj9L":"Mid-Market Companies","eYaZ":"Mid-Market - help desk ticket - First Stage","qz6j":"TAL AB x Costs","2WJ6":"Josh Test","AkpE":"Josh test","v3Gj":"Print Drivers | TAL A,B - First Stage","p5Bn":"Campaign Intent Visitors - Help Desk (MM only)","8qve":"Josh Test - Targets Security","KRnP":"Printing General Intent - Big and Mid","0W9v":"2301 Print Drivers Simplified - Mid Market (Insurance & Finance) - First Stage","QLw4":"2301 Print Drivers (Simplify vs. Eliminate)","w4zW":"Midmarket Finance & Insurance - 2301","x88b":"Test","QJqK":"Tier B","zPq2":"Tier A","XdEo":"Gartner IOCS 2023","4ElK":"Gartner IOCS 2023 - First Stage","7w9e":"Gartner IOCS 2023"}};
  var gaObjectAlias = config.gaObjectAlias;
  var thirdPartyLibraryLoaded = false;

  if(!w.Triblio){ w.Triblio = {}; }
  if(w.Triblio.onAccountIdentificationReady){ w.Triblio.onAccountIdentificationReady(firmographicRecord); }
  w.Triblio.getAccountIdentification = function(){
    return firmographicRecord;
  };

  if(!w.TriblioAssetNameTracking) w.TriblioAssetNameTracking = {queued:[]};
  if(config.firmTrackProvider === "ga4") {
    w.dataLayer = w.dataLayer || [];
  }

  function GATracker(){
    this.maxRetries = 1000;
    this.retryCount = 0;
  }

  GATracker.prototype.run = function(){
    var that = this;

    this.waitForThirdParty(function(){
      that.postFirmographicData();

      that.checkAssetNamesQueue();
    });
  };

  GATracker.prototype.waitForThirdParty = function(callback){
    var that = this;
    let hasFirmTrackProviderObject = true;

    if(config.firmTrackProvider === "ga4" && typeof w.google_tag_manager === "undefined") hasFirmTrackProviderObject = false;
    else if(config.firmTrackProvider === "ga" && typeof w[gaObjectAlias] === "undefined") hasFirmTrackProviderObject = false;

    let errorText = config.firmTrackProvider === "ga4" ? "Unable to find gtag or google tag manager analytics library on page" : "cant find google analytics library on page!";

    if(!hasFirmTrackProviderObject && this.retryCount <= this.maxRetries){
      /*wait for ga to load*/
      setTimeout(function(){
        that.retryCount++;
        that.waitForThirdParty(callback);
      }, 5);
    }
    else if(this.retryCount > this.maxRetries){
      console.log(errorText);
    }
    else{
      thirdPartyLibraryLoaded = true;
      callback();
    }
  };

  GATracker.prototype.postFirmographicData = function(){
    var data = {"name":"o2dc.com","sicCode":"N/A","isIsp":false,"employees":"N/A","revenue":"N/A","country":"N/A","domain":"o2dc.com","naicCode":"N/A","employeesCode":"N/A","revenueCode":"N/A","region":"N/A","city":"N/A","subIndustry":"N/A","industry":"N/A"};
if(window.google_tag_manager) {

                dataLayer.push({
                                  "event": "tr_firmographic_enrichment",
                                  "nonInteraction": true,"tr_name": data.name, 
				 "tr_sicCode": data.sicCode, 
				 "tr_isIsp": data.isIsp, 
				 "tr_employees": data.employees, 
				 "tr_revenue": data.revenue, 
				 "tr_city": data.city, 
				 "tr_region": data.region, 
				 "tr_country": data.country, 
				 "tr_domain": data.domain, 
				 "tr_subIndustry": data.subIndustry, 
				 "tr_industry": data.industry, 
				 "tr_naicCode": data.naicCode, 
				 "tr_employeesCode": data.employeesCode, 
				 "tr_revenueCode": data.revenueCode, 
				 "tr_SFpriority": "tr_SFpriority" 
 });
     
                }
                else console.log("cant find google tag manager on the page");
  };

  GATracker.prototype.checkAssetNamesQueue = function(){
    var that = this;

    if(w.TriblioAssetNameTracking.queued){
      w.TriblioAssetNameTracking.queued.forEach(function(ids){
        that.postAssetNames(ids);
      });
    }
  };

  GATracker.prototype.postAssetNames = function(ids){
    if(shouldTrackOrgAssets && thirdPartyLibraryLoaded){
      var data = _getAssetNamesFromIds(ids);

      
    if(data && data.length) {
      let firmData = {
        "event":"tr_event",
        "non_interaction": true
      };
      
      data.forEach(function(d){
        firmData[d.metricsLabel] = d.name;
      });

      dataLayer.push(firmData);
    }
  
    }
  };

  function _getAssetNamesFromIds(data){
    /*currently there is no click tracking on assets for ga, so get out of here!*/
    if(data.action === 'click') return [];

    var lookup = eIdsToNames;
    if(!lookup || !Object.keys(lookup).length){
      lookup = {personalizations:{}, contentHubs: {}, audiences:{}, campaigns:{}};
    }

    var names = [];
    var isTypeBoardAndHasData = data.hubId && lookup.contentHubs[data.hubId];

    if(isTypeBoardAndHasData){
      names.push({
        metricsLabel:config.metricsLabels.contentBoards,
        name: lookup.contentHubs[data.hubId],
        hitType: config.hitTypes.contentBoards
      });
    }
    else if(data.type !== "board" && data.personalizationId && data.audienceSegmentId && data.campaignId){
      var personalizationIds = data.personalizationId.split(",");
      var audienceSegmentIds = data.audienceSegmentId.split(",");
      var campaignIds = data.campaignId.split(",");

      personalizationIds.forEach(function(pId, index){
        var hasPersonalization = (personalizationIds[index] && lookup.personalizations[personalizationIds[index]]) ? true : false;
        var hasAudience = (audienceSegmentIds[index] && lookup.audiences[audienceSegmentIds[index]]) ? true : false;
        var hasCampaign = (campaignIds[index] && lookup.campaigns[campaignIds[index]]) ? true : false;

        if(hasPersonalization && hasAudience && hasCampaign){
          names.push({
            metricsLabel:config.metricsLabels.personalizations,
            name: lookup.personalizations[personalizationIds[index]],
            hitType: config.hitTypes.personalizations
          });

          names.push({
            metricsLabel: config.metricsLabels.campaigns,
            name: lookup.campaigns[campaignIds[index]],
            hitType: config.hitTypes.campaigns
          });

          names.push({
            metricsLabel: config.metricsLabels.audiences,
            name: lookup.audiences[audienceSegmentIds[index]],
            hitType: config.hitTypes.audiences
          });
        }
      });
    }
    return names;
  }

  var tracker = new GATracker();
  w.TriblioAssetNameTracking.postAssetNames = tracker.postAssetNames;

  tracker.run();
}(window));